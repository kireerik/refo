<h1 align="center">Refo</h1>

<p align="center">
	<a title="Node.js" href="https://nodejs.org/en/"><img alt="Node.js" src="https://camo.githubusercontent.com/9c24355bb3afbff914503b663ade7beb341079fa/68747470733a2f2f6e6f64656a732e6f72672f7374617469632f696d616765732f6c6f676f2d6c696768742e737667" width="" height="90"></a>
	&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<a title="Yarn" href="https://yarnpkg.com/lang/en/"><img alt="Yarn" src="https://raw.githubusercontent.com/yarnpkg/assets/master/yarn-kitten-full.svg?sanitize=true" width="" height="90"></a>
	&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<a title="HTML5" href="https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/HTML5"><img alt="HTML5" src="https://cdn.worldvectorlogo.com/logos/html-5.svg" width="" height="90"></a>
	&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<a title="CSS" href="https://developer.mozilla.org/en-US/docs/Web/CSS"><img alt="CSS" src="https://cdn.worldvectorlogo.com/logos/css-5.svg" width="" height="90"></a>
	&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<a title="JavaScript" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript"><img alt="JavaScript" src="https://cdn.worldvectorlogo.com/logos/javascript-4.svg" width="" height="90"></a>
	&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<a title="Puppeteer" href="https://developers.google.com/web/tools/puppeteer/"><img alt="Puppeteer" src="https://user-images.githubusercontent.com/10379601/29446482-04f7036a-841f-11e7-9872-91d1fc2ea683.png" width="" height="90"></a>
</p>

<p align="center">
	<br><a title="GitPunch" href="https://gitpunch.com/"><img alt="GitPunch" src="https://raw.githubusercontent.com/vfeskov/gitpunch/master/client/src/big-logo.png" width="222" height="52"></a>
	<br>⭐ Star and get notified about new releases via email.
</p>

<p align="center">
	<a title="Refo package downloads" href="https://www.npmjs.com/package/refo"><img alt="Refo package downloads" src="https://img.shields.io/npm/dt/refo.svg"></a>
</p>

## Features
- 
	- **H**ot **M**odule **R**eplacement with [hot-module-replacement](https://github.com/sidorares/hot-module-replacement)
	- JS, CSS and image inlining with [inline-source](https://github.com/popeindustries/inline-source)
	- HTML and inline CSS and JS minification with [HTMLMinifier](https://github.com/kangax/html-minifier)
	- JS bundling with [bundle-js](https://github.com/hugabor/bundle-js) and minification with [UglifyJS](https://github.com/mishoo/UglifyJS2)
- 
	- `Markdown` support for texts in `JSON` files with [markdown-it](https://github.com/markdown-it/markdown-it)
	- `PDF` generation with [puppeteer-html2pdf](https://github.com/kireerik/puppeteer-html2pdf)

#### Highlights
- Edit your resume data in a `JSON` file.
- View and publish your resume as a `PDF`, a `HTML` `document` and or as a page on a website.
- Design and customize resume layout with `HTML` and `CSS`.
- Generate 1 or more `PDF`s supporting different formats like `Letter` and `A4`.
- Refresh the `PDF` like ~`.3` seconds after saving changes and the `PDF` is updated too.

## Example
- <a title="Refo - A static site build tool." href="https://kireerik.github.io/refo/">kireerik.github.io/refo</a> &nbsp; &nbsp; [source code](https://github.com/kireerik/refo/tree/master/example) &nbsp; [hosted source](https://github.com/kireerik/refo/tree/master/docs)

> [Propose file change](https://github.com/kireerik/refo/edit/master/README.md) to add your new example.

## Packages
| name `version` | &nbsp; source code location: [index/](https://github.com/kireerik/refo/tree/master/index/) &nbsp; |
| --- | --- |
| [refo](https://www.npmjs.com/package/refo) `1.0.3` &nbsp; | &nbsp; &nbsp; [index/index](https://github.com/kireerik/refo/tree/master/index/index/index) &nbsp; &nbsp; |
| <ul><li>[core](https://www.npmjs.com/package/refo-core) `1.0.2` &nbsp; </li></ul> | &nbsp; &nbsp; [index/core/index](https://github.com/kireerik/refo/tree/master/index/index/core/index) &nbsp; &nbsp; |
| <ul><li><ul><li>[build](https://www.npmjs.com/package/refo-core-build) `1.0.1` &nbsp; </li></ul></li></ul> | &nbsp; &nbsp; [index/core/build](https://github.com/kireerik/refo/tree/master/index/index/core/build) &nbsp; &nbsp; |
| <ul><li><ul><li>[watch](https://www.npmjs.com/package/refo-core-watch) `1.0.2` &nbsp; </li></ul></li></ul> | &nbsp; &nbsp; [index/core/watch](https://github.com/kireerik/refo/tree/master/index/index/core/watch) &nbsp; &nbsp; |
| <ul><li>[main](https://www.npmjs.com/package/refo-main) `1.0.3` &nbsp; </li></ul> | &nbsp; &nbsp; [index/main](https://github.com/kireerik/refo/tree/master/index/index/main) &nbsp; &nbsp; |
| <ul><li>[directory-to-other-directory](https://www.npmjs.com/package/refo-directory-to-other-directory) `1.0.0` (=`0.0.0`) &nbsp; </li></ul> | &nbsp; &nbsp; [directory-to-other-directory](https://github.com/kireerik/refo/tree/master/index/directory-to-other-directory) &nbsp; &nbsp; |
| <ul><li>[handle-html](https://www.npmjs.com/package/refo-handle-html) `1.0.0` &nbsp; </li></ul> | &nbsp; &nbsp; [handle-html](https://github.com/kireerik/refo/tree/master/index/handle-html) &nbsp; &nbsp; |
| <ul><li>[pdf-source-change-handler](https://www.npmjs.com/package/refo-pdf-source-change-handler) `1.0.0` (=`0.0.2`) &nbsp; </li></ul> | &nbsp; &nbsp; [pdf-source-change-handler](https://github.com/kireerik/refo/tree/master/index/pdf-source-change-handler) &nbsp; &nbsp; |
| <ul><li>[handle-json](https://www.npmjs.com/package/refo-handle-json) `1.0.0` &nbsp; </li></ul> | &nbsp; &nbsp; [handle-json](https://github.com/kireerik/refo/tree/master/index/handle-json) &nbsp; &nbsp; |

## Usage

### Main
You can use `refo` as global and or as a local command as you can see in the `scripts` in the [example package.json](https://github.com/kireerik/refo/blob/master/example/package.json) file.

You can start Refo in `watch` mode by passing a `watch` parameter to the command. By default it creates a static build.

You can create a `refo.options` `js` or `json` file to change the default properties. Examples:

`.js`:
```JavaScript
module.exports = {
	staticDirectory: '../docs'
	, pdfSourceChangeHandler: {
		sourceDirectory: 'CV'
	}
}
```

`.json`:
```JavaScript
{
	"staticDirectory": "../docs"
	, "pdfSourceChangeHandler": {
		"sourceDirectory": "CV"
	}
}
```

Creating a Node module can be useful, because you can define functions as well and use additional code if needed.

You can also use Refo programmatically if you don't have a `refo.options` file in the folder where you require the `refo` package:
```JavaScript
const refo = require('refo')

refo(/*options*/)
```

You can define the 2. argument if you would like to use Refo programmatically in `watch` mode:
```JavaScript
process.argv[2] = 'watch'

const refo = require('refo')

refo(/*options*/)
```

#### Folder structure options
| property name				| default value | use case |
| ---					| :---:		| --- |
| `assetDirectory`			| `'asset'`	| Dependent HTML documents are regenerated when an inlined source changes. This property is only used in watch mode by inline-source. |
| `siteDirectory`			| `'site'`	| Node modules (not located in the `siteDirectory`/`assetDirectory` folder) and HTML files are processed with inline-source and HTMLMinifier and the result is saved to the `staticDirectory` folder as HTML. Other files are copied to the `staticDirectory` folder. |
| <ul><li>`assetDirectory`</li></ul>	| `'asset'`	| JavaScript files in this folder are bundled with bundle-js and minified with UglifyJS and saved to the `staticDirectory`/`assetDirectory` folder. |
| `staticDirectory`			| `'static'`	| Node modules (not located in the `siteDirectory`/`assetDirectory` folder) and HTML files from the `siteDirectory` folder are generated to this folder as HTML documents. Other files are copied to this folder from the `siteDirectory` folder. |

#### `pdfSourceChangeHandler` options
| property name		| default value			| use case |
| ---			| :---:				| --- |
| `sourceDirectory`	| `'resume'`			| PDF files are generated from the HTML documents located in this folder within the `staticDirectory` folder. |
| `fileNameSeparator`	| `'-'`				| Separator for the PDF file name. |
| `getFileNamePrefixum`	| [`async page => ...`](https://github.com/kireerik/refo/blob/9c8dfb3f7e973372d08569f33e89217f8487d024/index/pdf-source-change-handler/index.js#L10) | A function which generates the prefixum for the PDF file name. The default function returns the HTML document title before the `fileNameSeparator` without spaces. |
| `mainFileName`	| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`sourceDirectory`&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | Main name for the PDF file name. |
| `defaultFormat`	| `'Letter'`			| Default PDF page size format. This won't be included in the PDF file name by default. |
| `formats`		| `[defaultFormat, 'A4']`	| An array of generated PDF page size formats. A HTML document is saved in 2 formats by default. |

PDF files are saved to the root of the `staticDirectory` by default. You can modify this behaviour with a custom `getFileNamePrefixum` function.

### JSON handler
The JSON handler can be used as you can see in the example ([asset/resume/getHandledJson.js](https://github.com/kireerik/refo/blob/ec14756dc0046ff7c007e0af1200f39678e3e632/example/asset/resume/getHandledJson.js#L9)) as well.

```JavaScript
const handleJSON = require('refo-handle-json')

var json = JSON.parse(JSON.stringify(require('./data')))

json = handleJSON(json)
```

It is recommended to create a copy of the required JSON using the `JSON.parse(JSON.stringify(json))` functions for example when you are using Refo in `watch` mode ([related comment](https://github.com/sidorares/hot-module-replacement/issues/10#issuecomment-447473770)), because the JSON hander is changing object properties.

The JSON handler is parsing string object values as `Markdown` using markdown-it.

Properties which are ending with `-private` are removed. Objects which have a property named `private` are removed too.

Properties which are ending with `-full` are only included when a second true value parameter is passed to the handler function. Objects which have a property named `full` are only included when a second true value parameter is passed to the handler function.

When an object contains a `startDate` properrty without an `endDate` property then a `hidePresent` property can be used to hide a present label and show the current year instead.
<br>A `hideEndDate` property can be used to hide the current year shown instead of a present label.

A `hideDuration` property can be used to hide the calculated duration. Otherwise a `duration` property is defined with the calculated duration (examples: 7 months, 1 year, 1.5 years, 2 years).

### Core
You can use `refo-core` as global and or as a local command.

You can start Refo core in `watch` mode by passing a `watch` parameter to the command. By default it creates a static build.

You can create a `refo.core` `js` or `json` file to change the default properties. In general a `js` file is recommended, because you can define functions as well, but in some cases you might not need that.

The `handlers` property is not defined by default. In this case all files are copied from the `siteDirectory` to the `staticDirectory` folder without any additional processing.

The [folder structure options](https://github.com/kireerik/refo#folder-structure-options) are the same as for the main Refo package.

Example `refo.core.js`:
```JavaScript
module.exports = {
	handlers: {
		'.html': () => {}
	}
	//, options: {}
}
```

This example does nothing with each individual `.html` file. So these files are not saved to the `staticDirectory` folder.

> As a propbably more meaningful but still simple example you could make some changes to the files and save them to a dedicated folder for example.

The `handlers` property can be an object or a function. When it is a function the `options` property is passed as the first parameter to this function which can return the handler object.

Example `refo.core.js`:
```JavaScript
const fs = require('fs')

, getToStaticDirectory = require('refo-directory-to-other-directory')

module.exports = {
	handlers: ({siteDirectory, staticDirectory}) => {
		String.prototype.toStaticDirectory = getToStaticDirectory(siteDirectory, staticDirectory)

		return {
			'.html': filePath => {
				var html = fs.readFileSync(filePath, 'UTF-8')

				html = '<!DOCTYPE HTML>' + html

				fs.writeFile(filePath.toStaticDirectory(), html)
			}
		}
	}
}
```

This example pre-appends `<!DOCTYPE HTML>` to each HTML document located in the `siteDirectory` folder and saves them to the `staticDirectory` folder keeping the folder structure they had in the `siteDirectory` folder.

You can also use an [`addStaticFilePath`](https://github.com/kireerik/refo/blob/1f580272a79b5cb9b18528e98b749689370c65f0/index/index/core/watch/index.js#L12) function property in `watch` mode to register a new file path for the canged file. This can be useful when you are changing the extension of the result for example. For example you are saving `.js` as `.html` files just as the main refo package does. This function accepts 2 parameters. The original and the new static file path.

You can also use a [`watchedFileSource`](https://github.com/kireerik/refo/blob/1f580272a79b5cb9b18528e98b749689370c65f0/index/index/core/watch/index.js#L18-L19) object property in `watch` mode to register dependencies of a certain file. When a dependency changes the dependent file is regenerated. The main refo package uses this object in the HTML handler ([index/handle-html/index.js#L6-L18](https://github.com/kireerik/refo/blob/1f580272a79b5cb9b18528e98b749689370c65f0/index/handle-html/index.js#L6-L18)) to add inlined sources as dependencies.

> As a bit more complex example you can see Refo's main handlers: [index/index/main/handlers.js](https://github.com/kireerik/refo/blob/master/index/index/main/handlers.js)
> 
> <br>Feel free to make a copy to remove and add new features to it. You can publish your new handlers on NPM if you like the result so others can require and use your custom Refo handler too.

You can also use Refo core programmatically if you don't have a `refo.core` file in the folder where you require the `refo-core` package:
```JavaScript
const refoCore = require('refo-core')

refoCore(/*handlers, options*/)
```

You can define the 2. argument if you would like to use Refo core programmatically in `watch` mode:
```JavaScript
process.argv[2] = 'watch'

const refoCore = require('refo-core')

refoCore(/*handlers, options*/)
```

## Who is using Refo
- <a title="Oengi.com" href="https://oengi.com/">Oengi.com</a> – Erik Engi's website and resume.

> [Propose file change](https://github.com/kireerik/refo/edit/master/README.md) to add your project here.

## Inspiration
- <a title="JSON Resume" href="https://jsonresume.org/">JSON Resume</a>

#### Technologes


#### Author
- <a title="Oengi.com" href="https://oengi.com/">Erik Engi</a>

#### About the name
**Re**sume + port**fo**lio = Refo

Short and easy to type. Ideal as a command as well.
